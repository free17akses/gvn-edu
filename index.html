<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GAVIN EDU-PLAY | Fixed Version</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap');
        body { margin: 0; background: #B5FFFC; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Quicksand', sans-serif; }
        #game-container { border: 8px solid white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); background: #60DDCC; }
        
        #parent-btn { position: fixed; bottom: 20px; left: 20px; padding: 12px 20px; background: white; border: none; border-radius: 50px; cursor: pointer; z-index: 1000; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #parent-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 5000; flex-direction: column; justify-content: center; align-items: center; }
        .gate-box { background: white; padding: 30px; border-radius: 25px; text-align: center; width: 340px; color: #333; }
        .upload-section { margin: 15px 0; padding: 10px; border: 2px dashed #4CAF50; border-radius: 15px; background: #f9f9f9; }
        input[type="file"] { width: 100%; margin-top: 5px; font-size: 11px; }
        button.primary { background: #4CAF50; color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container"></div>
<button id="parent-btn" onclick="openGate()">‚öôÔ∏è Dashboard Orang Tua</button>

<div id="parent-overlay">
    <div id="security-gate" class="gate-box">
        <h2>üîí Keamanan</h2>
        <p id="math-question"></p>
        <input type="number" id="gate-answer" style="width:80%; padding:10px; font-size:20px; text-align:center;">
        <br><br>
        <button class="primary" onclick="checkGate()">MASUK</button>
    </div>

    <div id="monitor-info" style="display:none;" class="gate-box">
        <h3 style="margin-top:0">üé® Pengaturan Gambar</h3>
        <div class="upload-section">
            <label style="font-size:12px; font-weight:bold;">Latar Belakang:</label>
            <input type="file" accept="image/*" onchange="saveWithCompression(event, 'bg_gavin')">
        </div>
        <div class="upload-section">
            <label style="font-size:12px; font-weight:bold;">Karakter Gavin:</label>
            <input type="file" accept="image/*" onchange="saveWithCompression(event, 'char_gavin')">
        </div>
        <button class="primary" onclick="location.reload()">TERAPKAN & REFRESH</button>
        <button onclick="localStorage.clear(); location.reload();" style="background:none; border:none; color:red; margin-top:10px; cursor:pointer; font-size:11px;">Hapus & Reset Semua</button>
    </div>
</div>

<script>
    let currentAns = 0;

    function openGate() {
        let a = Math.floor(Math.random()*5)+3; let b = Math.floor(Math.random()*4)+2;
        currentAns = a * b;
        document.getElementById('math-question').innerText = `Berapa ${a} x ${b}?`;
        document.getElementById('parent-overlay').style.display = 'flex';
        document.getElementById('security-gate').style.display = 'block';
        document.getElementById('monitor-info').style.display = 'none';
    }

    function checkGate() {
        if(parseInt(document.getElementById('gate-answer').value) === currentAns) {
            document.getElementById('security-gate').style.display = 'none';
            document.getElementById('monitor-info').style.display = 'block';
        } else { alert("Jawaban Salah!"); closeOverlay(); }
    }

    function closeOverlay() { document.getElementById('parent-overlay').style.display = 'none'; }

    function saveWithCompression(event, key) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.src = e.target.result;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 1280; // Paksa lebar ke standar game
                canvas.height = 720;
                ctx.drawImage(img, 0, 0, 1280, 720);
                const compressedData = canvas.toDataURL('image/jpeg', 0.7);
                try {
                    localStorage.setItem(key, compressedData);
                    alert("Gambar berhasil disimpan!");
                } catch (err) { alert("Memori penuh!"); }
            };
        };
        reader.readAsDataURL(file);
    }

    class GameScene extends Phaser.Scene {
        constructor() { super('GameScene'); }
        preload() {
            const bgData = localStorage.getItem('bg_gavin');
            const charData = localStorage.getItem('char_gavin');

            if(bgData) this.textures.addBase64('bg', bgData);
            else this.load.image('bg', 'https://via.placeholder.com/1280x720/60DDCC/FFFFFF?text=Upload+Latar+Belakang');

            if(charData) this.textures.addBase64('char', charData);
            else this.load.image('char', 'https://via.placeholder.com/200x300/FFC107/FFFFFF?text=Gavin');
        }

        create() {
            // Latar Belakang (Dibuat pas layar)
            let bg = this.add.image(0, 0, 'bg').setOrigin(0, 0);
            bg.setDisplaySize(1280, 720);

            // Karakter
            let char = this.add.image(400, 500, 'char');
            char.setScale(0.8);

            // Tombol Mulai Manual (Pasti Muncul)
            let btnBox = this.add.rectangle(950, 450, 280, 90, 0x4caf50).setInteractive({useHandCursor: true});
            let btnText = this.add.text(950, 450, 'MULAI BELAJAR', { fontSize: '24px', fill: '#ffffff', fontWeight: 'bold' }).setOrigin(0.5);

            btnBox.on('pointerdown', () => {
                btnBox.setFillStyle(0x388E3C);
                alert("Petualangan Dimulai!");
            });
            btnBox.on('pointerup', () => btnBox.setFillStyle(0x4caf50));
        }
    }

    const config = {
        type: Phaser.AUTO,
        parent: 'game-container',
        width: 1280, height: 720,
        backgroundColor: '#60DDCC',
        scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        scene: [GameScene]
    };
    new Phaser.Game(config);
</script>
</body>
</html>
